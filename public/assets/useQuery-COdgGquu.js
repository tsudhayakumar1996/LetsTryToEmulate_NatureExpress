var Ft=i=>{throw TypeError(i)};var rt=(i,t,e)=>t.has(i)||Ft("Cannot "+e);var s=(i,t,e)=>(rt(i,t,"read from private field"),e?e.call(i):t.get(i)),f=(i,t,e)=>t.has(i)?Ft("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),o=(i,t,e,r)=>(rt(i,t,"write to private field"),r?r.call(i,e):t.set(i,e),e),l=(i,t,e)=>(rt(i,t,"access private method"),e);import{R as qt,t as nt,b as ht,u as D,s as kt,v as Tt,q as _t,n as mt,e as Lt,w as at,x as jt,S as Ht,y as Ot,j as ot,r as et,z as ut,A as Ut,f as Bt,l as Kt,k as wt}from"./utils-D_r6aIjw.js";import{r as T}from"./index-C7SD2Up6.js";import{u as Gt}from"./QueryClientProvider-BuhiEC0T.js";var K,G,F,q,b,X,k,E,x,Qt,le=(Qt=class extends qt{constructor(t){super();f(this,E);f(this,K);f(this,G);f(this,F);f(this,q);f(this,b);f(this,X);f(this,k);o(this,k,!1),o(this,X,t.defaultOptions),this.setOptions(t.options),this.observers=[],o(this,q,t.client),o(this,F,s(this,q).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,o(this,K,zt(this.options)),this.state=t.state??s(this,K),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=s(this,b))==null?void 0:t.promise}setOptions(t){this.options={...s(this,X),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&s(this,F).remove(this)}setData(t,e){const r=nt(this.state.data,t,this.options);return l(this,E,x).call(this,{data:r,type:"success",dataUpdatedAt:e==null?void 0:e.updatedAt,manual:e==null?void 0:e.manual}),r}setState(t,e){l(this,E,x).call(this,{type:"setState",state:t,setStateOptions:e})}cancel(t){var r,u;const e=(r=s(this,b))==null?void 0:r.promise;return(u=s(this,b))==null||u.cancel(t),e?e.then(ht).catch(ht):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(s(this,K))}isActive(){return this.observers.some(t=>D(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===kt||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!Tt(this.state.dataUpdatedAt,t)}onFocus(){var e;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(e=s(this,b))==null||e.continue()}onOnline(){var e;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(e=s(this,b))==null||e.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),s(this,F).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(s(this,b)&&(s(this,k)?s(this,b).cancel({revert:!0}):s(this,b).cancelRetry()),this.scheduleGc()),s(this,F).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||l(this,E,x).call(this,{type:"invalidate"})}fetch(t,e){var y,C,A;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(e!=null&&e.cancelRefetch))this.cancel({silent:!0});else if(s(this,b))return s(this,b).continueRetry(),s(this,b).promise}if(t&&this.setOptions(t),!this.options.queryFn){const a=this.observers.find(v=>v.options.queryFn);a&&this.setOptions(a.options)}const r=new AbortController,u=a=>{Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(o(this,k,!0),r.signal)})},d=()=>{const a=Lt(this.options,e),v={client:s(this,q),queryKey:this.queryKey,meta:this.meta};return u(v),o(this,k,!1),this.options.persister?this.options.persister(a,v,this):a(v)},n={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:s(this,q),state:this.state,fetchFn:d};u(n),(y=this.options.behavior)==null||y.onFetch(n,this),o(this,G,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((C=n.fetchOptions)==null?void 0:C.meta))&&l(this,E,x).call(this,{type:"fetch",meta:(A=n.fetchOptions)==null?void 0:A.meta});const O=a=>{var v,p,U,w;at(a)&&a.silent||l(this,E,x).call(this,{type:"error",error:a}),at(a)||((p=(v=s(this,F).config).onError)==null||p.call(v,a,this),(w=(U=s(this,F).config).onSettled)==null||w.call(U,this.state.data,a,this)),this.scheduleGc()};return o(this,b,_t({initialPromise:e==null?void 0:e.initialPromise,fn:n.fetchFn,abort:r.abort.bind(r),onSuccess:a=>{var v,p,U,w;if(a===void 0){O(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(a)}catch(m){O(m);return}(p=(v=s(this,F).config).onSuccess)==null||p.call(v,a,this),(w=(U=s(this,F).config).onSettled)==null||w.call(U,a,this.state.error,this),this.scheduleGc()},onError:O,onFail:(a,v)=>{l(this,E,x).call(this,{type:"failed",failureCount:a,error:v})},onPause:()=>{l(this,E,x).call(this,{type:"pause"})},onContinue:()=>{l(this,E,x).call(this,{type:"continue"})},retry:n.options.retry,retryDelay:n.options.retryDelay,networkMode:n.options.networkMode,canRun:()=>!0})),s(this,b).start()}},K=new WeakMap,G=new WeakMap,F=new WeakMap,q=new WeakMap,b=new WeakMap,X=new WeakMap,k=new WeakMap,E=new WeakSet,x=function(t){const e=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...At(r.data,this.options),fetchMeta:t.meta??null};case"success":return{...r,data:t.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const u=t.error;return at(u)&&u.revert&&s(this,G)?{...s(this,G),fetchStatus:"idle"}:{...r,error:u,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=e(this.state),mt.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),s(this,F).notify({query:this,type:"updated",action:t})})},Qt);function At(i,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:jt(t.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function zt(i){const t=typeof i.initialData=="function"?i.initialData():i.initialData,e=t!==void 0,r=e?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}var S,h,Y,R,_,z,M,Q,Z,W,V,L,j,P,N,c,J,ct,lt,dt,ft,pt,yt,vt,Mt,xt,Wt=(xt=class extends Ht{constructor(t,e){super();f(this,c);f(this,S);f(this,h);f(this,Y);f(this,R);f(this,_);f(this,z);f(this,M);f(this,Q);f(this,Z);f(this,W);f(this,V);f(this,L);f(this,j);f(this,P);f(this,N,new Set);this.options=e,o(this,S,t),o(this,Q,null),o(this,M,Ot()),this.options.experimental_prefetchInRender||s(this,M).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(e)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,h).addObserver(this),Et(s(this,h),this.options)?l(this,c,J).call(this):this.updateResult(),l(this,c,ft).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return bt(s(this,h),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return bt(s(this,h),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,l(this,c,pt).call(this),l(this,c,yt).call(this),s(this,h).removeObserver(this)}setOptions(t){const e=this.options,r=s(this,h);if(this.options=s(this,S).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof D(this.options.enabled,s(this,h))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");l(this,c,vt).call(this),s(this,h).setOptions(this.options),e._defaulted&&!ot(this.options,e)&&s(this,S).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,h),observer:this});const u=this.hasListeners();u&&Dt(s(this,h),r,this.options,e)&&l(this,c,J).call(this),this.updateResult(),u&&(s(this,h)!==r||D(this.options.enabled,s(this,h))!==D(e.enabled,s(this,h))||et(this.options.staleTime,s(this,h))!==et(e.staleTime,s(this,h)))&&l(this,c,ct).call(this);const d=l(this,c,lt).call(this);u&&(s(this,h)!==r||D(this.options.enabled,s(this,h))!==D(e.enabled,s(this,h))||d!==s(this,P))&&l(this,c,dt).call(this,d)}getOptimisticResult(t){const e=s(this,S).getQueryCache().build(s(this,S),t),r=this.createResult(e,t);return Nt(this,r)&&(o(this,R,r),o(this,z,this.options),o(this,_,s(this,h).state)),r}getCurrentResult(){return s(this,R)}trackResult(t,e){const r={};return Object.keys(t).forEach(u=>{Object.defineProperty(r,u,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(u),e==null||e(u),t[u])})}),r}trackProp(t){s(this,N).add(t)}getCurrentQuery(){return s(this,h)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=s(this,S).defaultQueryOptions(t),r=s(this,S).getQueryCache().build(s(this,S),e);return r.fetch().then(()=>this.createResult(r,e))}fetch(t){return l(this,c,J).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,R)))}createResult(t,e){var St;const r=s(this,h),u=this.options,d=s(this,R),n=s(this,_),O=s(this,z),C=t!==r?t.state:s(this,Y),{state:A}=t;let a={...A},v=!1,p;if(e._optimisticResults){const g=this.hasListeners(),H=!g&&Et(t,e),B=g&&Dt(t,r,e,u);(H||B)&&(a={...a,...At(A.data,t.options)}),e._optimisticResults==="isRestoring"&&(a.fetchStatus="idle")}let{error:U,errorUpdatedAt:w,status:m}=a;if(e.select&&a.data!==void 0)if(d&&a.data===(n==null?void 0:n.data)&&e.select===s(this,Z))p=s(this,W);else try{o(this,Z,e.select),p=e.select(a.data),p=nt(d==null?void 0:d.data,p,e),o(this,W,p),o(this,Q,null)}catch(g){o(this,Q,g)}else p=a.data;if(e.placeholderData!==void 0&&p===void 0&&m==="pending"){let g;if(d!=null&&d.isPlaceholderData&&e.placeholderData===(O==null?void 0:O.placeholderData))g=d.data;else if(g=typeof e.placeholderData=="function"?e.placeholderData((St=s(this,V))==null?void 0:St.state.data,s(this,V)):e.placeholderData,e.select&&g!==void 0)try{g=e.select(g),o(this,Q,null)}catch(H){o(this,Q,H)}g!==void 0&&(m="success",p=nt(d==null?void 0:d.data,g,e),v=!0)}s(this,Q)&&(U=s(this,Q),p=s(this,W),w=Date.now(),m="error");const $=a.fetchStatus==="fetching",st=m==="pending",it=m==="error",Rt=st&&$,Ct=p!==void 0,I={status:m,fetchStatus:a.fetchStatus,isPending:st,isSuccess:m==="success",isError:it,isInitialLoading:Rt,isLoading:Rt,data:p,dataUpdatedAt:a.dataUpdatedAt,error:U,errorUpdatedAt:w,failureCount:a.fetchFailureCount,failureReason:a.fetchFailureReason,errorUpdateCount:a.errorUpdateCount,isFetched:a.dataUpdateCount>0||a.errorUpdateCount>0,isFetchedAfterMount:a.dataUpdateCount>C.dataUpdateCount||a.errorUpdateCount>C.errorUpdateCount,isFetching:$,isRefetching:$&&!st,isLoadingError:it&&!Ct,isPaused:a.fetchStatus==="paused",isPlaceholderData:v,isRefetchError:it&&Ct,isStale:gt(t,e),refetch:this.refetch,promise:s(this,M)};if(this.options.experimental_prefetchInRender){const g=tt=>{I.status==="error"?tt.reject(I.error):I.data!==void 0&&tt.resolve(I.data)},H=()=>{const tt=o(this,M,I.promise=Ot());g(tt)},B=s(this,M);switch(B.status){case"pending":t.queryHash===r.queryHash&&g(B);break;case"fulfilled":(I.status==="error"||I.data!==B.value)&&H();break;case"rejected":(I.status!=="error"||I.error!==B.reason)&&H();break}}return I}updateResult(){const t=s(this,R),e=this.createResult(s(this,h),this.options);if(o(this,_,s(this,h).state),o(this,z,this.options),s(this,_).data!==void 0&&o(this,V,s(this,h)),ot(e,t))return;o(this,R,e);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:u}=this.options,d=typeof u=="function"?u():u;if(d==="all"||!d&&!s(this,N).size)return!0;const n=new Set(d??s(this,N));return this.options.throwOnError&&n.add("error"),Object.keys(s(this,R)).some(O=>{const y=O;return s(this,R)[y]!==t[y]&&n.has(y)})};l(this,c,Mt).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&l(this,c,ft).call(this)}},S=new WeakMap,h=new WeakMap,Y=new WeakMap,R=new WeakMap,_=new WeakMap,z=new WeakMap,M=new WeakMap,Q=new WeakMap,Z=new WeakMap,W=new WeakMap,V=new WeakMap,L=new WeakMap,j=new WeakMap,P=new WeakMap,N=new WeakMap,c=new WeakSet,J=function(t){l(this,c,vt).call(this);let e=s(this,h).fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(ht)),e},ct=function(){l(this,c,pt).call(this);const t=et(this.options.staleTime,s(this,h));if(ut||s(this,R).isStale||!Ut(t))return;const r=Tt(s(this,R).dataUpdatedAt,t)+1;o(this,L,setTimeout(()=>{s(this,R).isStale||this.updateResult()},r))},lt=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,h)):this.options.refetchInterval)??!1},dt=function(t){l(this,c,yt).call(this),o(this,P,t),!(ut||D(this.options.enabled,s(this,h))===!1||!Ut(s(this,P))||s(this,P)===0)&&o(this,j,setInterval(()=>{(this.options.refetchIntervalInBackground||Bt.isFocused())&&l(this,c,J).call(this)},s(this,P)))},ft=function(){l(this,c,ct).call(this),l(this,c,dt).call(this,l(this,c,lt).call(this))},pt=function(){s(this,L)&&(clearTimeout(s(this,L)),o(this,L,void 0))},yt=function(){s(this,j)&&(clearInterval(s(this,j)),o(this,j,void 0))},vt=function(){const t=s(this,S).getQueryCache().build(s(this,S),this.options);if(t===s(this,h))return;const e=s(this,h);o(this,h,t),o(this,Y,t.state),this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))},Mt=function(t){mt.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(s(this,R))}),s(this,S).getQueryCache().notify({query:s(this,h),type:"observerResultsUpdated"})})},xt);function Vt(i,t){return D(t.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&t.retryOnMount===!1)}function Et(i,t){return Vt(i,t)||i.state.data!==void 0&&bt(i,t,t.refetchOnMount)}function bt(i,t,e){if(D(t.enabled,i)!==!1){const r=typeof e=="function"?e(i):e;return r==="always"||r!==!1&&gt(i,t)}return!1}function Dt(i,t,e,r){return(i!==t||D(r.enabled,i)===!1)&&(!e.suspense||i.state.status!=="error")&&gt(i,e)}function gt(i,t){return D(t.enabled,i)!==!1&&i.isStaleByTime(et(t.staleTime,i))}function Nt(i,t){return!ot(i.getCurrentResult(),t)}var Pt=T.createContext(!1),$t=()=>T.useContext(Pt);Pt.Provider;function Jt(){let i=!1;return{clearReset:()=>{i=!1},reset:()=>{i=!0},isReset:()=>i}}var Xt=T.createContext(Jt()),Yt=()=>T.useContext(Xt),Zt=(i,t)=>{(i.suspense||i.throwOnError||i.experimental_prefetchInRender)&&(t.isReset()||(i.retryOnMount=!1))},te=i=>{T.useEffect(()=>{i.clearReset()},[i])},ee=({result:i,errorResetBoundary:t,throwOnError:e,query:r,suspense:u})=>i.isError&&!t.isReset()&&!i.isFetching&&r&&(u&&i.data===void 0||Kt(e,[i.error,r])),se=i=>{const t=i.staleTime;i.suspense&&(i.staleTime=typeof t=="function"?(...e)=>Math.max(t(...e),1e3):Math.max(t??1e3,1e3),typeof i.gcTime=="number"&&(i.gcTime=Math.max(i.gcTime,1e3)))},ie=(i,t)=>i.isLoading&&i.isFetching&&!t,re=(i,t)=>(i==null?void 0:i.suspense)&&t.isPending,It=(i,t,e)=>t.fetchOptimistic(i).catch(()=>{e.clearReset()});function ae(i,t,e){var a,v,p,U,w;const r=Gt(),u=$t(),d=Yt(),n=r.defaultQueryOptions(i);(v=(a=r.getDefaultOptions().queries)==null?void 0:a._experimental_beforeQuery)==null||v.call(a,n),n._optimisticResults=u?"isRestoring":"optimistic",se(n),Zt(n,d),te(d);const O=!r.getQueryCache().get(n.queryHash),[y]=T.useState(()=>new t(r,n)),C=y.getOptimisticResult(n),A=!u&&i.subscribed!==!1;if(T.useSyncExternalStore(T.useCallback(m=>{const $=A?y.subscribe(mt.batchCalls(m)):wt;return y.updateResult(),$},[y,A]),()=>y.getCurrentResult(),()=>y.getCurrentResult()),T.useEffect(()=>{y.setOptions(n)},[n,y]),re(n,C))throw It(n,y,d);if(ee({result:C,errorResetBoundary:d,throwOnError:n.throwOnError,query:r.getQueryCache().get(n.queryHash),suspense:n.suspense}))throw C.error;if((U=(p=r.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||U.call(p,n,C),n.experimental_prefetchInRender&&!ut&&ie(C,u)){const m=O?It(n,y,d):(w=r.getQueryCache().get(n.queryHash))==null?void 0:w.promise;m==null||m.catch(wt).finally(()=>{y.updateResult()})}return n.notifyOnChangeProps?C:y.trackResult(C)}function de(i,t){return ae(i,Wt)}export{le as Q,de as u};
